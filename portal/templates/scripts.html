<script type="text/javascript">

  function addDropdownItem(title, href) {
    var dropdown = document.getElementById("login-node-dropdown");
    // Create anchor element
    var a = document.createElement('a');
    // Create the text node for achor element
    var link = document.createTextNode(title);
    // Append the text node to anchor element.
    a.appendChild(link);
    // Set the title
    a.title = title;
    // Set the href property
    a.href = href;
    a.className = 'dropdown-item';
    a.target = '_blank';
    // Append the anchor element to the body
    dropdown.prepend(a);
  };

  $(document).ready(function() {
    // get current URL path and assign 'active' class
    const pathname = window.location.pathname;
    const pathsplit = pathname.split('/')
    const hostname = window.location.hostname
    const connect_name = hostname.split('.')[0];

    const connect_brand = document.getElementById("connect-brand");
    const nav_overview = document.getElementById("nav-overview");
    const nav_emailto = document.getElementById("nav-email");
    const nav_handbook = document.getElementById("nav-handbook");
    const nav_bar = document.getElementById("nav-main");

    if(connect_name === 'www') {
      document.title = 'CI-' + document.title;
    } else if(connect_name === 'psdconnect') {
      document.title = 'PSD UChicago ' + document.title;
    } else if(String(hostname).includes('connect.usatlas')){
      document.title = 'Atlas ' + document.title;
    } else if(String(hostname).includes('connect.uscms')) {
      document.title = 'Cms ' + document.title;
    } else {
      document.title = connect_name.charAt(0).toUpperCase() + connect_name.slice(1) + ' ' + document.title;
    };

    if(pathsplit.length > 1){
      var parentpath = pathsplit[1];
      $('nav > ul > li > a[href="/'+parentpath+'"]').parent().addClass('active');
    } else {
      // look to update the full a[href=''] uri below
      $('nav > ul > li > a[href="'+pathname+'"]').parent().addClass('active');
    }

    // Local
    if(String(hostname).includes('local')){

      connect_brand.src="{{url_for('static', filename='img/psd-connect-logo.png')}}";
      nav_overview.href="https://physicalsciences.uchicago.edu/";
      nav_emailto.href="mailto:support@ci-connect.uchicago.edu";
      // nav_bar.classList.add("psd-uchicago");
      document.getElementById("login-node-nav").style.display = "inline";
      // Set the title
      var title = "UChicago CI"
      // Set the href property
      var href = 'https://gracc.opensciencegrid.org/dashboard/db/osg-connect-summary-uchicago-ci?orgId=1';
      addDropdownItem(title, href);

    } else if(String(hostname).includes('atlas')){

      connect_brand.src="{{url_for('static', filename='img/atlas-connect-logo.png')}}";
      nav_overview.href="https://ci-connect.atlassian.net/wiki/spaces/AC/overview";
      nav_handbook.href="https://ci-connect.atlassian.net/wiki/spaces/AC/pages/1114129/ATLAS+Connect+Quickstart";
      nav_emailto.href="mailto:atlas-connect-l@lists.bnl.gov";

      var about_element = document.getElementById("nav-about");
      about_element.parentNode.removeChild(about_element);

    } else if(String(hostname).includes('cms')){

      connect_brand.src="{{url_for('static', filename='img/cms-connectlogo.png')}}";
      nav_overview.href="https://ci-connect.atlassian.net/wiki/spaces/CMS/overview";
      nav_emailto.href="mailto:cms-connect-support@cern.ch";
      document.getElementById("login-node-nav").style.display = "inline";
      // Set the title and href property
      var title = 'login.uscms.org';
      var href = 'https://grafana.mwt2.org/d/JiH0SAoZk/connect-servers?orgId=1&var-Server=login_uscms_org';
      // Call method to create dropdown menu item
      addDropdownItem(title, href);

      document.getElementById("nav-handbook").style.display = "inline";
      document.getElementById("nav-handbook").href="https://ci-connect.atlassian.net/wiki/spaces/CMS/pages/22609980/Introduction+to+CMS+Connect";

    } else if(String(hostname).includes('duke')) {

      connect_brand.src="{{url_for('static', filename='img/duke-connect-logo.png')}}";
      nav_overview.href="https://rc.duke.edu/national-computing-labs/duke-ci-connect-quick-start/";
      nav_emailto.href="mailto:scsc@duke.edu";

    } else if(String(hostname).includes('spt'))  {

      connect_brand.src="{{url_for('static', filename='img/spt-connect-logo.png')}}";
      nav_overview.href="https://pole.uchicago.edu/index.php";
      nav_emailto.href="mailto:jlstephen@uchicago.edu";
      document.getElementById("login-node-nav").style.display = "inline";
      // Set the title
      var title = "Amundsen Grid"
      var title_scott = 'Scott Grid'
      // Set the href property
      var href_amundsen = 'https://grafana.mwt2.org/d/JiH0SAoZk/connect-servers?orgId=1&var-Server=amundsen_grid_uchicago_edu';
      var href_scott = 'https://grafana.mwt2.org/d/JiH0SAoZk/connect-servers?orgId=1&var-Server=scott_grid_uchicago_edu';
      addDropdownItem(title, href_amundsen);
      addDropdownItem(title_scott, href_scott);

    } else if(String(hostname).includes('psd')){

      connect_brand.src="{{url_for('static', filename='img/psd-connect-logo.png')}}";
      nav_overview.href="https://physicalsciences.uchicago.edu/";
      nav_emailto.href="mailto:support@ci-connect.uchicago.edu";
      // nav_bar.classList.add("psd-uchicago");
      document.getElementById("login-node-nav").style.display = "inline";
      // Set the title
      var title = "UChicago CI Connect"
      // Set the href property
      var href = 'https://gracc.opensciencegrid.org/dashboard/db/osg-connect-summary-uchicago-ci?orgId=1';
      addDropdownItem(title, href);

    } else {
      connect_brand.src="{{url_for('static', filename='img/CIConnect_Logo.png')}}";
      nav_overview.parentNode.removeChild(nav_overview);
      nav_emailto.parentNode.removeChild(nav_emailto);
      // Remove footer for CI Connect
      var footer_element = document.getElementById("footer-container");
      footer_element.parentNode.removeChild(footer_element);
    };

  });

  $(function () {
    $('[data-toggle="popover"]').popover()
  })

  </script>
