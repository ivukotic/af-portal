{%extends "base.html"%}

{%block title%}
  Admin - Users
{%endblock%}

{%block body%}
<style>
    *, *::before, *::after {
        box-sizing: content-box !important;
    }
</style>
<section>
    <div class="container col-lg-12">
        {%include 'messages.html' %}
        <ol class="breadcrumb">
            <li class="breadcrumb-item">Admin</li>
            <li class="breadcrumb-item">Users</li>
        </ol>
        <h5>User Information</h5>
        <div id="spreadsheet"></div>
    </div>
</section>
<script type="text/javascript">
$(document).ready(function() {
    $.ajaxSetup({headers: { 'X-CSRF-TOKEN': "{{ csrf_token() }}" }});

    var changed = function(instance, cell, x, y, value) {
        row = spreadsheet.getRowData(y);
        $.post("{{url_for('admin_update_user_institution')}}", {'username': row[0], 'institution': row[3]});
    }
    
    spreadsheet = jspreadsheet(document.getElementById('spreadsheet'), {
        url: "{{url_for('admin_get_user_profiles')}}",
        columns:[
            { title:'Username', name:'username', width:200, type: 'text', readOnly: true },
            { title:'Email', name:'email', width: 300, type: 'text', readOnly: true },
            { title:'Join date', name:'join_date', width: 200, type: 'calendar', options: { format:'MM/DD/YYYY' }, readOnly: true },
            { title:'Institution', name:'institution', type: 'text', width: 400 }
        ],
        onchange: changed,
        loadingSpin: true,
        columnSorting: true,
        allowExport: true,
        csvFileName: 'users',
        toolbar:[
            {
                type: 'i',
                content: 'undo',
                onclick: function() {
                    spreadsheet.undo();
                }
            },
            {
                type: 'i',
                content: 'redo',
                onclick: function() {
                    spreadsheet.redo();
                }
            },
            {
                type: 'i',
                content: 'save',
                onclick: function () {
                    spreadsheet.download();
                }
            },
            /*{
                type: 'select',
                k: 'font-family',
                v: ['Arial','Verdana']
            },
            {
                type: 'select',
                k: 'font-size',
                v: ['9px','10px','11px','12px','13px','14px','15px','16px','17px','18px','19px','20px']
            },
            {
                type: 'i',
                content: 'format_align_left',
                k: 'text-align',
                v: 'left'
            },
            {
                type:'i',
                content:'format_align_center',
                k:'text-align',
                v:'center'
            },
            {
                type: 'i',
                content: 'format_align_right', 
                k: 'text-align',
                v: 'right'
            },
            {
                type: 'i',
                content: 'format_bold',
                k: 'font-weight',
                v: 'bold'
            },
            {
                type: 'color',
                content: 'format_color_text',
                k: 'color'
            },
            {
                type: 'color',
                content: 'format_color_fill',
                k: 'background-color'
            }*/
        ]
    });
});
</script>
{%endblock%}